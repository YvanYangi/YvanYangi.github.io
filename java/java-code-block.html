<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java代码块 | YangYangYang &#39;s Blog</title>
    <meta name="description" content="个人博客">
    <link rel="shortcut icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/styles.f683b4c6.css" as="style"><link rel="preload" href="/assets/js/app.f683b4c6.js" as="script"><link rel="preload" href="/assets/css/4.styles.50c27472.css" as="style"><link rel="preload" href="/assets/js/4.50c27472.js" as="script"><link rel="preload" href="/assets/css/0.styles.7d54da41.css" as="style"><link rel="preload" href="/assets/js/0.7d54da41.js" as="script"><link rel="preload" href="/assets/js/35.fe1e59eb.js" as="script"><link rel="prefetch" href="/assets/css/10.styles.82242ae5.css"><link rel="prefetch" href="/assets/css/12.styles.ac239c1a.css"><link rel="prefetch" href="/assets/css/13.styles.6d0d72ac.css"><link rel="prefetch" href="/assets/css/15.styles.a9d02288.css"><link rel="prefetch" href="/assets/css/16.styles.14f65a8d.css"><link rel="prefetch" href="/assets/css/17.styles.26c50035.css"><link rel="prefetch" href="/assets/css/18.styles.b0e60722.css"><link rel="prefetch" href="/assets/css/19.styles.8a06eb8d.css"><link rel="prefetch" href="/assets/css/2.styles.4691f751.css"><link rel="prefetch" href="/assets/css/20.styles.d5f5821a.css"><link rel="prefetch" href="/assets/css/21.styles.2c32c5a9.css"><link rel="prefetch" href="/assets/css/22.styles.dd37a877.css"><link rel="prefetch" href="/assets/css/23.styles.9c6e3f19.css"><link rel="prefetch" href="/assets/css/24.styles.ba0b5736.css"><link rel="prefetch" href="/assets/css/5.styles.eb0cf3ec.css"><link rel="prefetch" href="/assets/css/6.styles.3f72f639.css"><link rel="prefetch" href="/assets/css/7.styles.51367826.css"><link rel="prefetch" href="/assets/css/8.styles.df4e69a3.css"><link rel="prefetch" href="/assets/css/9.styles.13a61a09.css"><link rel="prefetch" href="/assets/js/10.82242ae5.js"><link rel="prefetch" href="/assets/js/11.31341d39.js"><link rel="prefetch" href="/assets/js/12.ac239c1a.js"><link rel="prefetch" href="/assets/js/13.6d0d72ac.js"><link rel="prefetch" href="/assets/js/14.77f430c4.js"><link rel="prefetch" href="/assets/js/15.a9d02288.js"><link rel="prefetch" href="/assets/js/16.14f65a8d.js"><link rel="prefetch" href="/assets/js/17.26c50035.js"><link rel="prefetch" href="/assets/js/18.b0e60722.js"><link rel="prefetch" href="/assets/js/19.8a06eb8d.js"><link rel="prefetch" href="/assets/js/20.d5f5821a.js"><link rel="prefetch" href="/assets/js/21.2c32c5a9.js"><link rel="prefetch" href="/assets/js/22.dd37a877.js"><link rel="prefetch" href="/assets/js/23.9c6e3f19.js"><link rel="prefetch" href="/assets/js/24.ba0b5736.js"><link rel="prefetch" href="/assets/js/25.cce36918.js"><link rel="prefetch" href="/assets/js/26.8dead230.js"><link rel="prefetch" href="/assets/js/27.025b8a9c.js"><link rel="prefetch" href="/assets/js/28.a2f04a72.js"><link rel="prefetch" href="/assets/js/29.36146808.js"><link rel="prefetch" href="/assets/js/30.9957db65.js"><link rel="prefetch" href="/assets/js/31.715a3053.js"><link rel="prefetch" href="/assets/js/32.133e49b5.js"><link rel="prefetch" href="/assets/js/33.adbd0b7b.js"><link rel="prefetch" href="/assets/js/34.8d6b989b.js"><link rel="prefetch" href="/assets/js/36.e3b4d1e2.js"><link rel="prefetch" href="/assets/js/37.d03b8ffc.js"><link rel="prefetch" href="/assets/js/38.114a0cc8.js"><link rel="prefetch" href="/assets/js/39.7c3619fd.js"><link rel="prefetch" href="/assets/js/5.eb0cf3ec.js"><link rel="prefetch" href="/assets/js/6.3f72f639.js"><link rel="prefetch" href="/assets/js/7.51367826.js"><link rel="prefetch" href="/assets/js/8.df4e69a3.js"><link rel="prefetch" href="/assets/js/9.13a61a09.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4691f751.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.45d55d38.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7d54da41.css"><link rel="stylesheet" href="/assets/css/10.styles.82242ae5.css"><link rel="stylesheet" href="/assets/css/12.styles.ac239c1a.css"><link rel="stylesheet" href="/assets/css/13.styles.6d0d72ac.css"><link rel="stylesheet" href="/assets/css/15.styles.a9d02288.css"><link rel="stylesheet" href="/assets/css/16.styles.14f65a8d.css"><link rel="stylesheet" href="/assets/css/17.styles.26c50035.css"><link rel="stylesheet" href="/assets/css/18.styles.b0e60722.css"><link rel="stylesheet" href="/assets/css/19.styles.8a06eb8d.css"><link rel="stylesheet" href="/assets/css/2.styles.4691f751.css"><link rel="stylesheet" href="/assets/css/20.styles.d5f5821a.css"><link rel="stylesheet" href="/assets/css/21.styles.2c32c5a9.css"><link rel="stylesheet" href="/assets/css/22.styles.dd37a877.css"><link rel="stylesheet" href="/assets/css/23.styles.9c6e3f19.css"><link rel="stylesheet" href="/assets/css/24.styles.ba0b5736.css"><link rel="stylesheet" href="/assets/css/4.styles.50c27472.css"><link rel="stylesheet" href="/assets/css/5.styles.eb0cf3ec.css"><link rel="stylesheet" href="/assets/css/6.styles.3f72f639.css"><link rel="stylesheet" href="/assets/css/7.styles.51367826.css"><link rel="stylesheet" href="/assets/css/8.styles.df4e69a3.css"><link rel="stylesheet" href="/assets/css/9.styles.13a61a09.css"><link rel="stylesheet" href="/assets/css/styles.f683b4c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YangYangYang 's Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/home/home.html" class="sidebar-link">主页</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/java/java-code-block.html" class="active sidebar-link">Java代码块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-basic.html" class="sidebar-link">Java基础</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaGuide</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>分布式</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>开发</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>版本控制</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="java代码块"><a href="#java代码块" aria-hidden="true" class="header-anchor">#</a> Java代码块</h1> <p>这里记录一些简便有趣的Java代码段。</p> <hr> <h3 id="产生两个数之间的随机数"><a href="#产生两个数之间的随机数" aria-hidden="true" class="header-anchor">#</a> 产生两个数之间的随机数</h3> <div class="language- extra-class"><pre class="language-text"><code>int pow = (int) Math.pow(10, 3); // 用于提取指定小数位
dateTrue = Math.floor((Math.random() * (max - min) + min) * pow) / pow;
</code></pre></div><hr> <h3 id="数字格式化"><a href="#数字格式化" aria-hidden="true" class="header-anchor">#</a> 数字格式化</h3> <div class="language- extra-class"><pre class="language-text"><code>NumberFormat nf = NumberFormat.getPercentInstance();//百分比格式
nf.setMinimumFractionDigits(0);//保留n位小数
nf.format(2.22);
</code></pre></div><hr> <h3 id="删除重复数据且只留一条"><a href="#删除重复数据且只留一条" aria-hidden="true" class="header-anchor">#</a> 删除重复数据且只留一条</h3> <div class="language- extra-class"><pre class="language-text"><code>delete from t_reception_visit_a16_copy1 
where  (visit_time,resident_id) in (select visit_time,resident_id  from t_reception_visit_a16_copy1 group by visit_time,resident_id  having count(1) &gt; 1) 
and  id not in (select min(id) from t_reception_visit_a16_copy1 group by visit_time,resident_id having count(1)&gt;1)
</code></pre></div><hr> <h3 id="查询锁表进程"><a href="#查询锁表进程" aria-hidden="true" class="header-anchor">#</a> 查询锁表进程</h3> <div class="language- extra-class"><pre class="language-text"><code>select concat('KILL ',id,';') from information_schema.processlist p inner
join information_schema.INNODB_TRX x on p.id=x.trx_mysql_thread_id where db='shequyun-sharding';
</code></pre></div><hr> <h3 id="esdump备份和恢复到文件"><a href="#esdump备份和恢复到文件" aria-hidden="true" class="header-anchor">#</a> esdump备份和恢复到文件</h3> <div class="language- extra-class"><pre class="language-text"><code>#备份
elasticdump  --input http://localhost:9200/syslog --output /home/syslog.json --type=data
#恢复
elasticdump --input /opt/shihuc/robotkdb.json --output &quot;http://10.90.7.10:9200/robotkdb”
</code></pre></div><hr> <h3 id="es-index相关"><a href="#es-index相关" aria-hidden="true" class="header-anchor">#</a> es index相关</h3> <div class="language- extra-class"><pre class="language-text"><code>#创建一个index
curl -H “Content-Type:application/json” -XPUT http://localhost:9200/syslog
#查询所有index
GET：http://172.31.27.170:9200/_cat/indices?v
#删除指定index中所有数据
curl --location --request POST 'http://172.31.27.170:9200/t_person_wide_wgs/_delete_by_query' --header 'Content-Type: application/json' --data-raw '{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}'
</code></pre></div><hr> <h3 id="批量执行sh命令"><a href="#批量执行sh命令" aria-hidden="true" class="header-anchor">#</a> 批量执行sh命令</h3> <div class="language- extra-class"><pre class="language-text"><code>for file in ls /data/misc/scripttest/*.sh
do
nohup sh $file &gt; $file.log &amp;
done
</code></pre></div><hr> <h3 id="mat分析headdump"><a href="#mat分析headdump" aria-hidden="true" class="header-anchor">#</a> mat分析headdump</h3> <div class="language- extra-class"><pre class="language-text"><code>#m.hprof就是jvm的dump文件，在mat目录下会生成3份.zip结尾的报告和一些m.相关的文件，将生成的m.hprof相关的文件都下载到windows本地磁盘
./ParseHeapDump.sh m.hprof  org.eclipse.mat.api:suspects org.eclipse.mat.api:overview org.eclipse.mat.api:top_components
</code></pre></div><hr> <h3 id="logstash配置文件示例"><a href="#logstash配置文件示例" aria-hidden="true" class="header-anchor">#</a> logstash配置文件示例</h3> <div class="language- extra-class"><pre class="language-text"><code>input {
        stdin {}


        jdbc {
                type =&gt; &quot;shequyun-sharding_t_community_org_a03&quot;
                jdbc_connection_string =&gt; &quot;jdbc:mysql://172.31.27.178:3306/shequyun-sharding?characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=GMT%2B8&quot;
                jdbc_user =&gt; &quot;root&quot;
                jdbc_password =&gt; &quot;communitycloud&quot;
                jdbc_driver_library =&gt; &quot;/home/logstash-7.10.0/mysql/mysql-connector-java-8.0.22.jar&quot;
                jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;
                connection_retry_attempts =&gt; &quot;3&quot;
                jdbc_validate_connection =&gt; &quot;true&quot;
                jdbc_validation_timeout =&gt; &quot;3600&quot;
                jdbc_paging_enabled =&gt; &quot;true&quot;
                jdbc_page_size =&gt; &quot;500&quot;
                statement =&gt; &quot;SELECT id,cid,corg_name,pid,level,create_user,create_time,update_user,update_time,sys_org_code,del_flag,corg_order,icon,is_doorplate_node,node_typename,house_address,landlord_name,landlord_tel,remark,is_rent_out,org_code,is_keep_a_dog,dog_count,is_empty_close,person_count,house_count,zone_code,upper_cloud,tag_infos,car_info FROM `t_community_org_a03` WHERE update_time &gt; :sql_last_value order by update_time asc&quot;
                lowercase_column_names =&gt; false
                sql_log_level =&gt; warn
                record_last_run =&gt; true
                use_column_value =&gt; true
                tracking_column =&gt; &quot;update_time&quot;
                tracking_column_type =&gt; timestamp
                last_run_metadata_path =&gt; &quot;mysql/last_id_community_org_a03.txt&quot;
                clean_run =&gt; false
                schedule =&gt; &quot;*/10 * * * * *&quot;
                #设置默认时区，:sql_last_value的值就会从UTC转为设置的时区时间
                jdbc_default_timezone =&gt; &quot;Asia/Shanghai&quot;
        }

        jdbc {
                type =&gt; &quot;shequyun-sharding_t_community_org_a16&quot;
                jdbc_connection_string =&gt; &quot;jdbc:mysql://172.31.27.178:3306/shequyun-sharding?characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=GMT%2B8&quot;
                jdbc_user =&gt; &quot;root&quot;
                jdbc_password =&gt; &quot;communitycloud&quot;
                jdbc_driver_library =&gt; &quot;/home/logstash-7.10.0/mysql/mysql-connector-java-8.0.22.jar&quot;
                jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;
                connection_retry_attempts =&gt; &quot;3&quot;
                jdbc_validate_connection =&gt; &quot;true&quot;
                jdbc_validation_timeout =&gt; &quot;3600&quot;
                jdbc_paging_enabled =&gt; &quot;true&quot;
                jdbc_page_size =&gt; &quot;500&quot;
                statement =&gt; &quot;SELECT id,cid,corg_name,pid,level,create_user,create_time,update_user,update_time,sys_org_code,del_flag,corg_order,icon,is_doorplate_node,node_typename,house_address,landlord_name,landlord_tel,remark,is_rent_out,org_code,is_keep_a_dog,dog_count,is_empty_close,person_count,house_count,zone_code,upper_cloud,tag_infos,car_info FROM `t_community_org_a16` WHERE update_time &gt; :sql_last_value order by update_time asc&quot;
                lowercase_column_names =&gt; false
                sql_log_level =&gt; warn
                record_last_run =&gt; true
                use_column_value =&gt; true
                tracking_column =&gt; &quot;update_time&quot;
                tracking_column_type =&gt; timestamp
                last_run_metadata_path =&gt; &quot;mysql/last_id_community_org_a16.txt&quot;
                clean_run =&gt; false
                schedule =&gt; &quot;*/10 * * * * *&quot;
                #设置默认时区，:sql_last_value的值就会从UTC转为设置的时区时间
                jdbc_default_timezone =&gt; &quot;Asia/Shanghai&quot;
        }
}



output {

        if [type] == &quot;shequyun-sharding_t_community_org_a03&quot; {
                elasticsearch {
                        hosts =&gt; [&quot;172.31.27.170:9200&quot;]
                        index =&gt; &quot;community_org_a03&quot;
                        document_id =&gt; &quot;%{id}&quot;
                }
        }

        if [type] == &quot;shequyun-sharding_t_community_org_a16&quot; {
                elasticsearch {
                        hosts =&gt; [&quot;172.31.27.170:9200&quot;]
                        index =&gt; &quot;community_org_a16&quot;
                        document_id =&gt; &quot;%{id}&quot;
                }
        }

        stdout {
                codec =&gt; json_lines
        }
}
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">1/22/2021, 3:44:40 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/home/home.html" class="prev">
        主页
      </a></span> <span class="next"><a href="/java/java-basic.html">
        Java基础
      </a>
      →
    </span></p></div>  <div id="gitalk-container" class="content default"></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/4.50c27472.js" defer></script><script src="/assets/js/0.7d54da41.js" defer></script><script src="/assets/js/35.fe1e59eb.js" defer></script><script src="/assets/js/app.f683b4c6.js" defer></script>
  </body>
</html>
